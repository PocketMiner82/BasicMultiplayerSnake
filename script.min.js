!function(){const e="LightGrey",t=["Aqua","Yellow","Red","Black","White","DeepPink","LawnGreen","Orange","SaddleBrown","OrangeRed","DarkViolet","Gold","Indigo","Silver","DarkGreen"],n=t.length;var a,r=!1,o=0,l=0,s=!1,u=6,c=!0,d="",f=!1,y=[],v=0,p=!1,h=10,b=0,m=[],g=[],k=!1,x=[],w=0,E=0,B=-1;const I=document.getElementById("snakeboard"),S=I.getContext("2d"),T=1280,L=720;var M,R,C={apiKey:"AIzaSyBbRpK_BcltEmRQzLAUCFykMHEq5PQWWz4",authDomain:"psyched-canto-311609.firebaseapp.com",databaseURL:"https://psyched-canto-311609-default-rtdb.europe-west1.firebasedatabase.app",projectId:"psyched-canto-311609",storageBucket:"psyched-canto-311609.appspot.com",messagingSenderId:"556381649934",appId:"1:556381649934:web:af27169882d8297d78d05f"};function D(){l=Date.now(),u=6,c=!0,y=function(){for(var e=J(4),t=Z(),n=[],a=0;a<5;a++){var r=10*a;n[a]={x:e-r,y:t}}return n}(),s=!1,A()}function A(){return--u>0&&u<=3?(document.getElementById("status").innerHTML=u,void setTimeout(A,500)):u>0?(document.getElementById("status").innerHTML="Get ready!",void setTimeout(A,500)):ne()?(u=-1,document.getElementById("status").innerHTML="Waiting for other snake to go away...",void setTimeout(A,50)):(h=10,b=0,u=0,c=!1,void X("Go!",3e3))}function G(){var e=Date.now()-l;if(e>=100){for(var t=e-100,n=Math.max(1,Math.round(t/100)),a=0;a<n;a++)p=!1,H();0!=y.length&&ae(y),l=Date.now()}setTimeout(G,1)}function H(){!function(){var e=[],t="";for(var n in i=0,g){var a=ee(g[n].pos)-5;v=a>=0&&n==d?a:v,e[i]={score:a,playerName:n},i++}for(var r in e.sort(((e,t)=>t.score-e.score)),e){var o=e[r];a=o.score,n=o.playerName;t+='<span style="color:'+g[n].color+';text-shadow: 1px 0 black, -1px 0 black, 0 1px black, 0 -1px black, 1px 1px black, -1px -1px black, -1px 1px black, 1px -1px black;">'+j(n)+"</span>: "+(a<-4?"Spectator":a)+"<br>"}document.getElementById("sidebar").innerHTML="Online: "+te()+"/15<br><br>"+t}(),S.fillStyle=e,S.fillRect(0,0,T,L),function(){for(var e in x){var t=x[e];S.fillStyle=Q(U(t.level)),S.strokestyle="black",S.fillRect(t.x,t.y,10,10),S.strokeRect(t.x,t.y,10,10)}E++}(),function(){for(var e in m){var t=m[e];null!=t&&null!=t.pos&&t.pos.forEach((e=>F(null==t.color?"red":t.color,e)))}}(),0!=u||(s||y.length<=0||function(){for(var e=4;e<y.length;e++)if(y[e].x===y[0].x&&y[e].y===y[0].y)return!0;if(ne())return!0;const t=y[0].x<0,n=y[0].x>1270,a=y[0].y<0,r=y[0].y>710;return t||n||a||r}()?s||(s=!0,ae([]),function(){if(!(ee(y)<=5))for(var e in y){var t=y[e];t.x<0||t.x>1270||t.y<0||t.y>710||0==V(0,5)&&W(t.x,t.y,$())}}(),y=[],document.getElementById("status").style.visibility="visible",document.getElementById("status").innerHTML='<b><span style="color: Red; display: inline;"> Game Over!</span></b>',document.getElementById("score").style.visibility="visible",document.getElementById("score").innerHTML="Your score: "+v+'<button id="buttonRetry" class="button retry" onclick="onRetryClick()">Retry (r)</button>'):function(){const e={x:y[0].x+h,y:y[0].y+b};y.unshift(e);if(function(){var e=!1;for(var t in x){var n=x[t];if(y[0].x===n.x&&y[0].y===n.y){e=!0;break}}return e}()){var t=function(e){switch(e){case 0:case 1:case 2:return e+1;case 3:return V(-5,5);default:return 0}}(function(){var e=z(y[0].x,y[0].y),t=Math.max(1,Math.round(function(){var e=0;for(var t in g){var n=g[t];null!=n.pos&&0!=ee(n.pos)&&e++}return e}()/2));t-=x.length;for(var n=0;n<t;n++){for(var a,r=!0;r;)for(var o in a=O(),0==x.length&&(r=!1),x){var i=x[o];i.x==a.x&&i.y==a.y||(r=!1)}W(a.x,a.y,$())}return e}())-1;if(t<0)for(var n=0;n>t&&1!=ee(y);n--)y.pop();else w+=t;++t>0?X("+"+t,1e3,"LimeGreen"):0==t?X("0",1e3):t<0&&X(t,1e3,"Red")}else w<=0?y.pop():w--}()),function(){if(0==y.length)return;y.forEach((e=>F(a,e)))}(),retryClicked&&(retryClicked=!1,q())}function _(e,t,n,a){e?(h=0,b=-10):t?(h=-10,b=0):n?(h=0,b=10):a&&(h=10,b=0)}function W(e,t,n){x[x.length]={x:e,y:t,level:n},re()}function z(e,t){var n=[],a=3;for(var r in i=0,x){var o=x[r];foodX=o.x,foodY=o.y,e!=foodX||t!=foodY?(n[i]=o,i++):a=o.level}return x=n,re(),a}function O(){var e=J(),t=Z();return y.forEach((n=>{n.x==e&&n.y==t&&O()})),m.forEach((n=>{n.x==e&&n.y==t&&O()})),{x:e,y:t}}function Y(){!function(){var e=7*window.innerWidth/8,t=3*window.innerHeight/4,n=1.7777777777777777,a=T/e,r=L/t;a>r?(M=e,R=e/n):r>a?(M=t*n,R=t):(M=e,R=t);I.width=M,I.height=R,S.scale(M/T,R/L)}()}function N(e){if(p)return;p=!0;const t=e.keyCode;_((38===t||87===t)&&!(10===b),(37===t||65===t)&&!(10===h),(40===t||83===t)&&!(-10===b),(39===t||68===t)&&!(-10===h)),13!==t&&82!==t||q()}function P(e){var t=I.getBoundingClientRect(),n=M/T,a=R/L;const r=(e.touches[0].clientX-t.left)/n,o=(e.touches[0].clientY-t.top)/a;if(p)return;p=!0;_(!(!(360>o)||320>r||960<r||10===b),320>r&&!(10===h),!(!(360<o)||320>r||960<r||-10===b),960<r&&!(-10===h))}function q(){s&&(document.getElementById("score").style.visibility="hidden",D())}function F(e,t){S.fillStyle=e,S.strokestyle="black",S.fillRect(t.x,t.y,10,10),S.strokeRect(t.x,t.y,10,10)}function X(e,t,n){n=n||"Black",document.getElementById("status").style.visibility="visible",document.getElementById("status").innerHTML='<div style="color:'+n+';">'+e+"</div>",setTimeout((()=>{document.getElementById("status").innerHTML==='<div style="color:'+n+';">'+e+"</div>"&&(document.getElementById("status").style.visibility="hidden")}),t)}function K(){var e=function(){var e=[],n=[],a=0;for(var r in m)otherSnake=m[r],null!=otherSnake&&null!=otherSnake.color&&(e[a]=otherSnake.color,a++);for(var o in a=0,t)Array.from(e).includes(t[o])||(n[a]=t[o],a++);return n}();return e[V(0,e.length-1)]}function Q(e){return 50==E&&(E=-50),Color({h:e,s:100,v:(E<0?-1*E:E)+50}).toString()}function U(e){switch(e){case 0:return 175;case 1:return 110;case 2:default:return 0;case 3:return 10*V(0,30)}}function $(){if(B>=0)return B;var e=V(0,300);return e>=0&&e<100?0:e>=100&&e<200?1:e>=200&&e<250?2:3}function j(e){return String(e).replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace('"',"&quot;")}function V(e,t){return Math.round(Math.random()*(t-e)+e)}function J(e){return e=e||0,10*Math.round(V(10*e,1270)/10)}function Z(){return 10*Math.round(V(0,710)/10)}function ee(e){var t=0;for(var n in e)t++;return t}function te(){return ee(g)}function ne(){for(var e in m){var t=m[e].pos;if(null!=t)for(var n=0;n<t.length;n++)if(t[n].x===y[0].x&&t[n].y===y[0].y)return!0}return!1}function ae(e){c&&(e=[]),firebase.database().ref("snake/players/"+d+"/pos").set(e)}function re(){firebase.database().ref("snake/foods").set(x)}function oe(){r?(document.addEventListener("keydown",N),window.addEventListener("resize",Y,!1),I.addEventListener("touchstart",P),window.addEventListener("keydown",(function(e){[32,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault()}),!1),Y(),firebase.database().ref("snake/foods").on("value",(e=>{data=e.val(),x=null==data?[]:data})),firebase.database().ref("snake/forcedFoodLevel").on("value",(e=>{data=e.val(),B=null==data?-1:data})),firebase.database().ref("snake/players").on("value",(e=>{if(data=e.val(),null!=data){var t=[];for(var n in data)n!=d?t[n]=data[n]:a=data[n].color;m=t,g=data,k=!0}else k=!0})),ie()):setTimeout(oe,50)}function ie(){k?(!function(){for(;te()>=n;)alert("The game is full (15/15). Click the button, to retry.")}(),se(),le()):setTimeout(ie,50)}function le(){f?(firebase.database().ref("snake/players/"+d+"/verifyName").set(d),firebase.database().ref("snake/players/"+d).onDisconnect().remove(),a=K(),firebase.database().ref("snake/players/"+d+"/color").set(a),te()<=1&&0==x.length&&W(J(),Z(),$()),l=Date.now(),G(),D()):setTimeout(le,50)}function se(){for(f=!1,d="";""==d;){var e=prompt('Choose a player name:\n\n".", "/", "#", "$", "[", or "]" will be replaced by "_".');(d=(d=null==e?"":e).replaceAll(".","_").replaceAll("#","_").replaceAll("$","_").replaceAll("[","_").replaceAll("]","_").replaceAll("/","_")).length>16?(alert("This name is too long."),d=""):firebase.database().ref("snake/players/"+d+"/color").get().then((e=>{if(e.exists())return alert("Someone has already chosen this name."),d="",void se();f=!0}))}}alert("We use cookies. By using this site, you agree with it.\n\nWe use the Realtime Database of Google Firebase, to serve multiplayer. If you want to know how Google proceeds your data, look on their page: https://firebase.google.com/support/privacy/\n\nIf you don't want to agree, close this site. No data has been saved yet."),firebase.initializeApp(C),firebase.database().ref("snake/version").on("value",(e=>{data=e.val(),o=parseInt(data,10),function(){do{if(o>11){for(var e in r=!0,y=[],ae([]),g)if(otherSnake=y[e],e==d&&null!=otherSnake&&0!=ee(otherSnake))return;r=!1,alert("Client outdated. Please close the tab, delete all cookies and data from this page and reopen this page.\nThe easiest way is to delete all your browsing data.")}else if(o<11){for(var e in r=!0,y=[],ae([]),g)if(otherSnake=y[e],e==d&&null!=otherSnake&&0!=ee(otherSnake))return;r=!1,alert("Database outdated. Please wait for the database to update, then reopen this tab.")}else r=!0}while(!r)}()})),oe()}();
