!function(){function e(){ke=Date.now(),xe=6,Se=!0,Ie=r(),we=!1,t()}function t(){return xe--,xe>0&&xe<=3?(I(xe),void setTimeout(t,500)):xe>0?(I("Get ready!"),void setTimeout(t,500)):P()?(xe=-1,I("Waiting for other snake to go away...",color="Red"),void setTimeout(t,50)):(Le=ye,Me=0,xe=0,Se=!1,void I("Go!",3e3))}function n(){var e=Date.now(),t=e-ke;if(t>=te){for(var r=t-te,o=Math.max(1,Math.round(r/te)),i=0;i<o;i++)Te=!1,a();0!=Ie.length&&U(Ie),ke=Date.now()}setTimeout(n,1)}function a(){R(),w(),E(),N(),0!=xe||(we||Ie.length<=0||s()?we||h():o()),x(),retryClicked&&(retryClicked=!1,g())}function r(){for(var e=H(4),t=W(),n=[],a=0;a<5;a++){var r=a*ye;n[a]={x:e-r,y:t}}return n}function o(){const e={x:Ie[0].x+Le,y:Ie[0].y+Me};Ie.unshift(e);const t=u();if(t){var n=A(d())-1;if(n<0)for(var a=0;a>n&&1!=z(Ie);a--)Ie.pop();else _e+=n;n++,n>0?I("+"+n,1e3,"LimeGreen"):0==n?I("0",1e3):n<0&&I(n,1e3,"Red")}else _e<=0?Ie.pop():_e--}function l(e,t,n,a){e?(Le=0,Me=-ye):t?(Le=-ye,Me=0):n?(Le=0,Me=ye):a&&(Le=ye,Me=0)}function s(){for(var e=4;e<Ie.length;e++)if(Ie[e].x===Ie[0].x&&Ie[e].y===Ie[0].y)return!0;if(P())return!0;const t=Ie[0].x<0,n=Ie[0].x>de-ye,a=Ie[0].y<0,r=Ie[0].y>ve-ye;return t||n||a||r}function u(){var e=!1;for(var t in Ge){var n=Ge[t];if(Ie[0].x===n.x&&Ie[0].y===n.y){e=!0;break}}return e}function c(e,t,n){Ge[Ge.length]={x:e,y:t,level:n,uuid:crypto.randomUUID()},q()}function f(e,t){var n=[],a=ne;for(var r in i=0,Ge){var o=Ge[r];foodX=o.x,foodY=o.y,e!=foodX||t!=foodY?(n[i]=o,i++):a=o.level}return Ge=n,q(),a}function d(){var e=f(Ie[0].x,Ie[0].y),t=Math.max(1,Math.round(Y()/2))*ze;t-=Ge.length;for(var n=0;n<t;n++){for(var a,r=!0;r;)for(var o in a=v(),0==Ge.length&&(r=!1),Ge){var i=Ge[o];i.x==a.x&&i.y==a.y||(r=!1)}c(a.x,a.y,C())}return e}function v(){var e=H(),t=W();return Ie.forEach(n=>{const a=n.x==e&&n.y==t;a&&v()}),De.forEach(n=>{const a=n.x==e&&n.y==t;a&&v()}),{x:e,y:t}}function y(){if(!(z(Ie)<=5))for(var e in Ie){var t=Ie[e];t.x<0||t.x>de-ye||t.y<0||t.y>ve-ye||0==_(0,5)&&c(t.x,t.y,C())}}function h(){we=!0,U([]),y(),Ie=[],I("Game Over!",0,"Red"),document.getElementById("score").style.visibility="visible",document.getElementById("score").innerHTML="Your score: "+Be+'<button id="buttonRetry" class="button retry" onclick="onRetryClick()">Retry (r)</button>'}function p(){k()}function b(e){const t=38,n=87,a=37,r=65,o=40,i=83,s=39,u=68,c=13,f=82;if(Te)return;Te=!0;const d=e.keyCode,v=Me===-ye,y=Me===ye,h=Le===ye,p=Le===-ye;l((d===t||d===n)&&!y,(d===a||d===r)&&!h,(d===o||d===i)&&!v,(d===s||d===u)&&!p),d!==c&&d!==f||g()}function m(e){var t=ce,n=t.getBoundingClientRect(),a=pe/de,r=be/ve;const o=(e.touches[0].clientX-n.left)/a,i=(e.touches[0].clientY-n.top)/r;if(Te)return;Te=!0;const s=Me===-ye,u=Me===ye,c=Le===ye,f=Le===-ye,d=!(!(ve/2>i)||de/4>o||de-de/4<o||u),v=de/4>o&&!c,y=!(!(ve/2<i)||de/4>o||de-de/4<o||s),h=de-de/4<o&&!f;l(d,v,y,h)}function g(){we&&(document.getElementById("score").style.visibility="hidden",e())}function k(){var e=1.5*window.innerWidth*.5,t=1.5*window.innerHeight*.75,n=de/ve,a=de/e,r=ve/t;a>r?(pe=e,be=e/n):r>a?(pe=t*n,be=t):(pe=e,be=t),ce.width=pe,ce.height=be,fe.scale(pe/de,be/ve)}function w(){fe.fillStyle=Z,fe.fillRect(0,0,de,ve)}function x(){0!=Ie.length&&Ie.forEach(e=>S(he,e))}function S(e,t){fe.fillStyle=e,fe.strokestyle="black",fe.fillRect(t.x,t.y,ye,ye),fe.strokeRect(t.x,t.y,ye,ye)}function E(){for(var e in Ge){var t=Ge[e];fe.fillStyle=M(D(t.level)),fe.strokestyle="black",fe.fillRect(t.x,t.y,ye,ye),fe.strokeRect(t.x,t.y,ye,ye)}He++}function R(){var e=[],t="";for(var n in i=0,Ce){var a=z(Ce[n].pos)-5;Be=a>=0&&n==Ee?a:Be,e[i]={score:a,playerName:n},i++}for(var r in e.sort((e,t)=>t.score-e.score),e){var o=e[r],l=(a=o.score,n=o.playerName,Ce[n]);t+='<span id="scoreboard" style="color:'+l.color+';">'+G(n)+"</span>: "+(a<-4?"Spectator":a)+"<br>"}document.getElementById("sidebar").innerHTML="Online: "+O()+"/15<br><br>"+t}function I(e,t=0,n="Black"){var a='<div id="innerStatus" style="color: '+n+';">'+e+"</div>";document.getElementById("status").innerHTML=a,t>0&&setTimeout(()=>{document.getElementById("status").innerHTML===a&&(document.getElementById("status").innerHTML='<div id="innerStatus" style="color: transparent;">42</div')},t)}function B(){do{if(ge>J){for(var e in me=!0,Ie=[],U([]),Ce)if(otherSnake=Ie[e],e==Ee&&null!=otherSnake&&0!=z(otherSnake))return;me=!1,alert("Client outdated. Please close the tab, delete all cookies and data from this page and reopen this page.\nThe easiest way is to delete all your browsing data.")}else if(ge<J){for(var e in me=!0,Ie=[],U([]),Ce)if(otherSnake=Ie[e],e==Ee&&null!=otherSnake&&0!=z(otherSnake))return;me=!1,alert("Database outdated. Please wait for the database to update, then reopen this tab.")}else me=!0}while(!me)}function T(){var e=L(),t=e[_(0,e.length-1)];return t}function L(){var e=[],t=[],n=0;for(var a in De)otherSnake=De[a],null!=otherSnake&&null!=otherSnake.color&&(e[n]=otherSnake.color,n++);for(var r in n=0,ee)Array.from(e).includes(ee[r])||(t[n]=ee[r],n++);return t}function M(e){50==He&&(He=-50);var t={h:e,s:100,v:(He<0?-1*He:He)+50},n=Color(t);return n.toString()}function D(e){switch(e){case ae:return ie;case re:return le;case oe:return se;case ne:return 10*_(0,30);default:return 0}}function C(){if(We>=0)return We;var e=_(0,300);return e>=0&&e<100?ae:e>=100&&e<200?re:e>=200&&e<250?oe:ne}function A(e){return 0==e?_(-10,10):e}function G(e){return String(e).replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace('"',"&quot;")}function _(e,t){return Math.round(Math.random()*(t-e)+e)}function H(e){return e=e||0,Math.round(_(e*ye,de-ye)/ye)*ye}function W(){return Math.round(_(0,ve-ye)/ye)*ye}function z(e){var t=0;for(var n in e)t++;return t}function O(){return z(Ce)}function Y(){var e=0;for(var t in Ce){var n=Ce[t];null!=n.pos&&0!=z(n.pos)&&e++}return e}function F(){for(;O()>=ue;)alert("The game is full (15/15). Click the button, to retry.")}function N(){for(var e in De){var t=De[e];null!=t&&null!=t.pos&&t.pos.forEach(e=>S(null==t.color?"red":t.color,e))}}function P(){for(var e in De){var t=De[e].pos;if(null!=t)for(var n=0;n<t.length;n++)if(t[n].x===Ie[0].x&&t[n].y===Ie[0].y)return!0}return!1}function U(e){Se&&(e=[]),firebase.database().ref("snake/players/"+Ee+"/pos").set(e)}function q(){firebase.database().ref("snake/foods").set(Ge)}function X(){firebase.database().ref("snake/foods").on("value",e=>{data=e.val(),Ge=null==data?[]:data}),firebase.database().ref("snake/variables/forcedFoodLevel").on("value",e=>{data=e.val(),We=null==data?-1:data}),firebase.database().ref("snake/variables/foodFactor").on("value",e=>{data=e.val(),ze=null==data?1:data}),firebase.database().ref("snake/players").on("value",e=>{if(data=e.val(),null!=data){var t=[];for(var n in data)n!=Ee?t[n]=data[n]:he=data[n].color;De=t,Ce=data,Ae=!0}else Ae=!0})}function K(){p(),alert("We use cookies. By using this site, you agree with it.\n\nWe use the Realtime Database of Google Firebase, to serve multiplayer. If you want to know how Google proceeds your data, look on their page: https://firebase.google.com/support/privacy/\n\nIf you don't want to agree, close this site. No data has been saved yet."),firebase.initializeApp(Oe),firebase.database().ref("snake/variables/version").on("value",e=>{data=e.val(),ge=parseInt(data,10),B()}),Q()}function Q(){me?(document.addEventListener("keydown",b),window.addEventListener("resize",p,!1),ce.addEventListener("touchstart",m),window.addEventListener("keydown",function(e){[32,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault()},!1),p(),X(),$()):setTimeout(Q,50)}function $(){Ae?(F(),V(),j()):setTimeout($,50)}function j(){Re?(firebase.database().ref("snake/players/"+Ee+"/verifyName").set(Ee),firebase.database().ref("snake/players/"+Ee).onDisconnect().remove(),he=T(),firebase.database().ref("snake/players/"+Ee+"/color").set(he),0==Ge.length&&c(H(),W(),C()),ke=Date.now(),n(),e()):setTimeout(j,50)}function V(){for(Re=!1,Ee="";""==Ee;){var e=prompt('Choose a player name:\n\n".", "/", "#", "$", "[", or "]" will be replaced by "_".');Ee=null==e?"":e,Ee=Ee.replaceAll(".","_").replaceAll("#","_").replaceAll("$","_").replaceAll("[","_").replaceAll("]","_").replaceAll("/","_"),Ee.length>16?(alert("This name is too long."),Ee=""):firebase.database().ref("snake/players/"+Ee+"/color").get().then(e=>{if(e.exists())return alert("Someone has already chosen this name."),Ee="",void V();Re=!0})}}const J=16,Z="#555555",ee=["Aqua","Yellow","Red","Black","White","DeepPink","LawnGreen","Orange","SaddleBrown","OrangeRed","DarkViolet","Gold","Indigo","Silver","DarkGreen"],te=100,ne=0,ae=1,re=2,oe=3,ie=175,le=110,se=0,ue=ee.length,ce=document.getElementById("snakeboard"),fe=ce.getContext("2d"),de=1280,ve=720,ye=16;var he,pe,be,me=!1,ge=0,ke=0,we=!1,xe=6,Se=!0,Ee="",Re=!1,Ie=[],Be=0,Te=!1,Le=ye,Me=0,De=[],Ce=[],Ae=!1,Ge=[],_e=0,He=0,We=-1,ze=1,Oe={apiKey:"AIzaSyBbRpK_BcltEmRQzLAUCFykMHEq5PQWWz4",authDomain:"psyched-canto-311609.firebaseapp.com",databaseURL:"https://psyched-canto-311609-default-rtdb.europe-west1.firebasedatabase.app",projectId:"psyched-canto-311609",storageBucket:"psyched-canto-311609.appspot.com",messagingSenderId:"556381649934",appId:"1:556381649934:web:af27169882d8297d78d05f"};K()}();