!function(){const e=5,t="LightGrey",n=["Aqua","Yellow","Red","Black","White","DeepPink","LawnGreen","Orange","SaddleBrown","OrangeRed","DarkViolet","Gold","Indigo","Silver","DarkGreen"],a=100,r=0,o=1,l=2,s=3,c=175,u=110,d=0,f=n.length;var y,v=!1,p=0,h=0,b=!1,m=6,g=!0,k="",x=!1,w=[],E=0,B=!1,I=10,S=0,T=[],L=[],M=!1,R=[],A=0,C=-1;const D=document.getElementById("snakeboard"),G=D.getContext("2d"),H=1280,_=720;var W,z,Y={apiKey:"AIzaSyBbRpK_BcltEmRQzLAUCFykMHEq5PQWWz4",authDomain:"psyched-canto-311609.firebaseapp.com",databaseURL:"https://psyched-canto-311609-default-rtdb.europe-west1.firebasedatabase.app",projectId:"psyched-canto-311609",storageBucket:"psyched-canto-311609.appspot.com",messagingSenderId:"556381649934",appId:"1:556381649934:web:af27169882d8297d78d05f"};function N(){h=Date.now(),m=6,g=!0,w=function(){for(var e=oe(4),t=ie(),n=[],a=0;a<5;a++){var r=10*a;n[a]={x:e-r,y:t}}return n}(),b=!1,O()}function O(){return--m>0&&m<=3?(document.getElementById("status").innerHTML=m,void setTimeout(O,500)):m>0?(document.getElementById("status").innerHTML="Get ready!",void setTimeout(O,500)):ce()?(m=-1,document.getElementById("status").innerHTML="Waiting for other snake to go away...",void setTimeout(O,50)):(I=10,S=0,m=0,g=!1,void Z("Go!",3e3))}function P(){var e=Date.now()-h;if(e>=a){for(var t=e-a,n=Math.max(1,Math.round(t/a)),r=0;r<n;r++)B=!1,q();0!=w.length&&ue(w),h=Date.now()}setTimeout(P,1)}function q(){!function(){var e=[],t="";for(var n in i=0,L){var a=10*(le(L[n].pos)-5);E=a>=0&&n==k?a:E,e[i]={score:a,playerName:n},i++}for(var r in e.sort((e,t)=>t.score-e.score),e){var o=e[r],a=o.score,n=o.playerName,l=L[n];t+='<span style="color:'+l.color+';text-shadow: 1px 0 black, -1px 0 black, 0 1px black, 0 -1px black, 1px 1px black, -1px -1px black, -1px 1px black, 1px -1px black;">'+String(n).replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace('"',"&quot;")+"</span>: "+(a<-40?"Spectator":a)+"<br>"}document.getElementById("sidebar").innerHTML="Online: "+se()+"/15<br><br>"+t}(),G.fillStyle=t,G.fillRect(0,0,H,_),function(){for(var e in R){var t=R[e];G.fillStyle=te(ne(t.level)),G.strokestyle="black",G.fillRect(t.x,t.y,10,10),G.strokeRect(t.x,t.y,10,10)}A++}(),function(){for(var e in T){var t=T[e];null!=t&&null!=t.pos&&t.pos.forEach(e=>J(null==t.color?"red":t.color,e))}}(),0!=m||(b||w.length<=0||function(){for(var e=4;e<w.length;e++)if(w[e].x===w[0].x&&w[e].y===w[0].y)return!0;if(ce())return!0;const t=w[0].x<0,n=w[0].x>H-10,a=w[0].y<0,r=w[0].y>_-10;return t||n||a||r}()?b||(b=!0,ue([]),function(){if(!(le(w)<=5))for(var e in w){var t=w[e];t.x<0||t.x>H-10||t.y<0||t.y>_-10||0==re(0,5)&&X(t.x,t.y,ae())}}(),w=[],document.getElementById("status").style.visibility="visible",document.getElementById("status").innerHTML='<b><span style="color: Red; display: inline;"> Game Over!</span></b> <button id="buttonRetry" class="button retry" onclick="onRetryClick()">Retry (r)</button>',document.getElementById("score").style.visibility="visible",document.getElementById("score").innerHTML="Your score: "+E):function(){const e={x:w[0].x+I,y:w[0].y+S};if(w.unshift(e),function(){var e=!1;for(var t in R){var n=R[t];if(w[0].x===n.x&&w[0].y===n.y){e=!0;break}}return e}()){var t=function(e){switch(e){case r:case o:case l:return e+1;case s:return re(-5,5);default:return 0}}(function(){var e=K(w[0].x,w[0].y),t=Math.max(1,Math.round(function(){var e=0;for(var t in L){var n=L[t];null!=n.pos&&0!=le(n.pos)&&e++}return e}()/2));t-=R.length;for(var n=0;n<t;n++){for(var a,r=!0;r;)for(var o in a=Q(),0==R.length&&(r=!1),R){var i=R[o];i.x==a.x&&i.y==a.y||(r=!1)}X(a.x,a.y,ae())}return e}())-1;if(t<0)for(var n=0;n>t&&1!=le(w);n--)w.pop();else for(var n=0;n<t;n++){var a=w[w.length-1].x-I,i=w[w.length-1].y-S;w[le(w)]={x:a,y:i}}++t>0?Z("+"+t+"0",1e3,"LimeGreen"):0==t?Z("0",1e3):t<0&&Z(t+"0",1e3,"Red")}else w.pop()}()),function(){if(0==w.length)return;w.forEach(e=>J(y,e))}(),retryClicked&&(retryClicked=!1,V())}function F(e,t,n,a){e?(I=0,S=-10):t?(I=-10,S=0):n?(I=0,S=10):a&&(I=10,S=0)}function X(e,t,n){R[R.length]={x:e,y:t,level:n},de()}function K(e,t){var n=[],a=s;for(var r in i=0,R){var o=R[r];foodX=o.x,foodY=o.y,e!=foodX||t!=foodY?(n[i]=o,i++):a=o.level}return R=n,de(),a}function Q(){var e=oe(),t=ie();return w.forEach(n=>{n.x==e&&n.y==t&&Q()}),T.forEach(n=>{n.x==e&&n.y==t&&Q()}),{x:e,y:t}}function U(){!function(){var e=7*window.innerWidth/8,t=3*window.innerHeight/4,n=H/_,a=H/e,r=_/t;a>r?(W=e,z=e/n):r>a?(W=t*n,z=t):(W=e,z=t);D.width=W,D.height=z,G.scale(W/H,z/_)}()}function $(e){if(B)return;B=!0;const t=e.keyCode;F((38===t||87===t)&&!(10===S),(37===t||65===t)&&!(10===I),(40===t||83===t)&&!(-10===S),(39===t||68===t)&&!(-10===I)),13!==t&&82!==t||V()}function j(e){var t=e.target.getBoundingClientRect(),n=W/H,a=z/_;const r=(e.clientX-t.left)/n,o=(e.clientY-t.top)/a;B||(B=!0,F(!(!(_/2>o)||H/4>r||H-H/4<r||10===S),H/4>r&&!(10===I),!(!(_/2<o)||H/4>r||H-H/4<r||-10===S),H-H/4<r&&!(-10===I)))}function V(){b&&(document.getElementById("score").style.visibility="hidden",N())}function J(e,t){G.fillStyle=e,G.strokestyle="black",G.fillRect(t.x,t.y,10,10),G.strokeRect(t.x,t.y,10,10)}function Z(e,t,n){n=n||"Black",document.getElementById("status").style.visibility="visible",document.getElementById("status").innerHTML='<div style="color:'+n+';">'+e+"</div>",setTimeout(()=>{document.getElementById("status").innerHTML==='<div style="color:'+n+';">'+e+"</div>"&&(document.getElementById("status").style.visibility="hidden")},t)}function ee(){var e=function(){var e=[],t=[],a=0;for(var r in T)otherSnake=T[r],null!=otherSnake&&null!=otherSnake.color&&(e[a]=otherSnake.color,a++);for(var o in a=0,n)Array.from(e).includes(n[o])||(t[a]=n[o],a++);return t}();return e[re(0,e.length-1)]}function te(e){return 50==A&&(A=-50),Color({h:e,s:100,v:(A<0?-1*A:A)+50}).toString()}function ne(e){switch(e){case r:return c;case o:return u;case l:return d;case s:return 10*re(0,30);default:return 0}}function ae(){if(C>=0)return C;var e=re(0,300);return e>=0&&e<100?r:e>=100&&e<200?o:e>=200&&e<250?l:s}function re(e,t){return Math.round(Math.random()*(t-e)+e)}function oe(e){return e=e||0,10*Math.round(re(10*e,H-10)/10)}function ie(){return 10*Math.round(re(0,_-10)/10)}function le(e){var t=0;for(var n in e)t++;return t}function se(){return le(L)}function ce(){for(var e in T){var t=T[e].pos;if(null!=t)for(var n=0;n<t.length;n++)if(t[n].x===w[0].x&&t[n].y===w[0].y)return!0}return!1}function ue(e){g&&(e=[]),firebase.database().ref("snake/players/"+k+"/pos").set(e)}function de(){firebase.database().ref("snake/foods").set(R)}function fe(){v?(document.addEventListener("keydown",$),window.addEventListener("resize",U,!1),D.addEventListener("click",j),U(),firebase.database().ref("snake/foods").on("value",e=>{data=e.val(),R=null==data?[]:data}),firebase.database().ref("snake/forcedFoodLevel").on("value",e=>{data=e.val(),C=null==data?-1:data}),firebase.database().ref("snake/players").on("value",e=>{if(data=e.val(),null!=data){var t=[];for(var n in data)n!=k?t[n]=data[n]:y=data[n].color;T=t,L=data,M=!0}else M=!0}),ye()):setTimeout(fe,50)}function ye(){M?(!function(){for(;se()>=f;)alert("The game is full (15/15). Click the button, to retry.")}(),function e(){x=!1;k="";for(;""==k;){var t=prompt('Choose a player name:\n\n".", "/", "#", "$", "[", or "]" will be replaced by "_".');(k=(k=null==t?"":t).replaceAll(".","_").replaceAll("#","_").replaceAll("$","_").replaceAll("[","_").replaceAll("]","_").replaceAll("/","_")).length>16?(alert("This name is too long."),k=""):firebase.database().ref("snake/players/"+k+"/color").get().then(t=>{if(t.exists())return alert("Someone has already chosen this name."),k="",void e();x=!0})}}(),ve()):setTimeout(ye,50)}function ve(){x?(firebase.database().ref("snake/players/"+k+"/verifyName").set(k),firebase.database().ref("snake/players/"+k).onDisconnect().remove(),y=ee(),firebase.database().ref("snake/players/"+k+"/color").set(y),se()<=1&&0==R.length&&X(oe(),ie(),ae()),h=Date.now(),P(),N()):setTimeout(ve,50)}alert("We use cookies. By using this site, you agree with it.\n\nWe use the Realtime Database of Google Firebase, to serve multiplayer. If you want to know how Google proceeds your data, look on their page: https://firebase.google.com/support/privacy/\n\nIf you don't want to agree, close this site. No data has been saved yet."),firebase.initializeApp(Y),firebase.database().ref("snake/version").on("value",t=>{data=t.val(),p=parseInt(data,10),function(){do{if(p>e){for(var t in v=!0,w=[],ue([]),L)if(otherSnake=w[t],t==k&&null!=otherSnake&&0!=le(otherSnake))return;v=!1,alert("Client outdated. Please close the tab, delete all cookies and data from this page and reopen this page.\nThe easiest way is to delete all your browsing data.")}else if(p<e){for(var t in v=!0,w=[],ue([]),L)if(otherSnake=w[t],t==k&&null!=otherSnake&&0!=le(otherSnake))return;v=!1,alert("Database outdated. Please wait for the database to update, then reopen this tab.")}else v=!0}while(!v)}()}),fe()}();