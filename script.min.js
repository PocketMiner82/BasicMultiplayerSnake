!function(){let e=["Aqua","Yellow","Red","Black","White","DeepPink","LawnGreen","Orange","SaddleBrown","OrangeRed","DarkViolet","Gold","Indigo","Silver","DarkGreen"],t=e.length;var n,r,a,o=!1,l=0,$=0,s=!1,u=6,c=!0,f="",_=!1,d=[],y=0,v=!1,p=10,h=0,b=[],g=[],k=!1,x=[],m=0,w=0,E=-1,B=1;let I=document.getElementById("snakeboard"),L=I.getContext("2d");var R={apiKey:"AIzaSyBbRpK_BcltEmRQzLAUCFykMHEq5PQWWz4",authDomain:"psyched-canto-311609.firebaseapp.com",databaseURL:"https://psyched-canto-311609-default-rtdb.europe-west1.firebasedatabase.app",projectId:"psyched-canto-311609",storageBucket:"psyched-canto-311609.appspot.com",messagingSenderId:"556381649934",appId:"1:556381649934:web:af27169882d8297d78d05f"};function T(){$=Date.now(),u=6,c=!0,d=function e(){for(var t=Y(4),n=K(),r=[],a=0;a<5;a++){var o=10*a;r[a]={x:t-o,y:n}}return r}(),s=!1,function e(){if(--u>0&&u<=3){document.getElementById("status").innerHTML=u,setTimeout(e,500);return}if(u>0){document.getElementById("status").innerHTML="Get ready!",setTimeout(e,500);return}if(V()){u=-1,document.getElementById("status").innerHTML="Waiting for other snake to go away...",setTimeout(e,50);return}p=10,h=0,u=0,c=!1,O("Go!",3e3)}()}function A(){(function e(){var t=[],n="";for(var r in i=0,g){var a=Q(g[r].pos)-5;y=a>=0&&r==f?a:y,t[i]={score:a,playerName:r},i++}for(var o in t.sort((e,t)=>t.score-e.score),t){var l=t[o],a=l.score,r=l.playerName;n+='<span style="color:'+g[r].color+';text-shadow: 1px 0 black, -1px 0 black, 0 1px black, 0 -1px black, 1px 1px black, -1px -1px black, -1px 1px black, 1px -1px black;">'+U(r)+"</span>: "+(a<-4?"Spectator":a)+"<br>"}document.getElementById("sidebar").innerHTML="Online: "+j()+"/15<br><br>"+n})(),L.fillStyle="LightGrey",L.fillRect(0,0,1280,720),function e(){for(var t in x){var n=x[t];L.fillStyle=F(N(n.level)),L.strokestyle="black",L.fillRect(n.x,n.y,10,10),L.strokeRect(n.x,n.y,10,10)}w++}(),function e(){for(var t in b){var n=b[t];null!=n&&null!=n.pos&&n.pos.forEach(e=>z(null==n.color?"red":n.color,e))}}(),0==u&&(s||d.length<=0||function e(){for(var t=4;t<d.length;t++)if(d[t].x===d[0].x&&d[t].y===d[0].y)return!0;if(V())return!0;let n=d[0].x<0,r=d[0].x>1270,a=d[0].y<0,o=d[0].y>710;return n||r||a||o}()?s||(s=!0,X([]),function e(){if(!(5>=Q(d)))for(var t in d){var n=d[t];n.x<0||n.x>1270||n.y<0||n.y>710||0!=q(0,5)||H(n.x,n.y,P())}}(),d=[],document.getElementById("status").style.visibility="visible",document.getElementById("status").innerHTML='<b><span style="color: Red; display: inline;"> Game Over!</span></b>',document.getElementById("score").style.visibility="visible",document.getElementById("score").innerHTML="Your score: "+y+'<button id="buttonRetry" class="button retry" onclick="onRetryClick()">Retry (r)</button>'):function e(){let t={x:d[0].x+p,y:d[0].y+h};d.unshift(t);let n=function e(){var t=!1;for(var n in x){var r=x[n];if(d[0].x===r.x&&d[0].y===r.y){t=!0;break}}return t}();if(n){var r=function e(t){switch(t){case 0:case 1:case 2:return t+1;case 3:return q(-5,5);default:return 0}}(function e(){var t=function e(t,n){var r=[],a=3;for(var o in i=0,x){var l=x[o];foodX=l.x,foodY=l.y,t!=foodX||n!=foodY?(r[i]=l,i++):a=l.level}return x=r,J(),a}(d[0].x,d[0].y),n=Math.max(1,Math.round(function e(){var t=0;for(var n in g){var r=g[n];null!=r.pos&&0!=Q(r.pos)&&t++}return t}()/2))*B;n-=x.length;for(var r=0;r<n;r++){for(var a,o=!0;o;)for(var l in a=S(),0==x.length&&(o=!1),x){var $=x[l];($.x!=a.x||$.y!=a.y)&&(o=!1)}H(a.x,a.y,P())}return t}())-1;if(r<0)for(var a=0;a>r&&1!=Q(d);a--)d.pop();else m+=r;++r>0?O("+"+r,1e3,"LimeGreen"):0==r?O("0",1e3):r<0&&O(r,1e3,"Red")}else m<=0?d.pop():m--}()),0!=d.length&&d.forEach(e=>z(n,e)),retryClicked&&(retryClicked=!1,W())}function G(e,t,n,r){e?(p=0,h=-10):t?(p=-10,h=0):n?(p=0,h=10):r&&(p=10,h=0)}function H(e,t,n){x[x.length]={x:e,y:t,level:n,uuid:crypto.randomUUID()},J()}function S(){var e=Y(),t=K();return d.forEach(n=>{let r=n.x==e&&n.y==t;r&&S()}),b.forEach(n=>{let r=n.x==e&&n.y==t;r&&S()}),{x:e,y:t}}function C(){var e,t,n,o,l;e=7*window.innerWidth/8,t=3*window.innerHeight/4,n=1280/720,o=1280/e,l=720/t,o>l?(r=e,a=e/n):l>o?(r=t*n,a=t):(r=e,a=t),I.width=r,I.height=a,L.scale(r/1280,a/720)}function D(e){if(v)return;v=!0;let t=e.keyCode,n=-10===h,r=10===h,a=10===p,o=-10===p;G((38===t||87===t)&&!r,(37===t||65===t)&&!a,(40===t||83===t)&&!n,(39===t||68===t)&&!o),(13===t||82===t)&&W()}function M(e){var t=I.getBoundingClientRect(),n=r/1280,o=a/720;let l=(e.touches[0].clientX-t.left)/n,$=(e.touches[0].clientY-t.top)/o;if(v)return;v=!0;let s=-10===h,u=10===h,c=10===p,f=-10===p;G(360>$&&!(320>l)&&!(960<l)&&!u,320>l&&!c,360<$&&!(320>l)&&!(960<l)&&!s,960<l&&!f)}function W(){s&&(document.getElementById("score").style.visibility="hidden",T())}function z(e,t){L.fillStyle=e,L.strokestyle="black",L.fillRect(t.x,t.y,10,10),L.strokeRect(t.x,t.y,10,10)}function O(e,t,n){n=n||"Black",document.getElementById("status").style.visibility="visible",document.getElementById("status").innerHTML='<div style="color:'+n+';">'+e+"</div>",setTimeout(()=>{document.getElementById("status").innerHTML==='<div style="color:'+n+';">'+e+"</div>"&&(document.getElementById("status").style.visibility="hidden")},t)}function F(e){var t;return 50==w&&(w=-50),Color({h:e,s:100,v:(w<0?-1*w:w)+50}).toString()}function N(e){switch(e){case 0:return 175;case 1:return 110;case 2:default:return 0;case 3:return 10*q(0,30)}}function P(){if(E>=0)return E;var e=q(0,300);return e>=0&&e<100?0:e>=100&&e<200?1:e>=200&&e<250?2:3}function U(e){return String(e).replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace('"',"&quot;")}function q(e,t){return Math.round(Math.random()*(t-e)+e)}function Y(e){return 10*Math.round(q(10*(e=e||0),1270)/10)}function K(){return 10*Math.round(q(0,710)/10)}function Q(e){var t=0;for(var n in e)t++;return t}function j(){return Q(g)}function V(){for(var e in b){var t=b[e].pos;if(null!=t){for(var n=0;n<t.length;n++)if(t[n].x===d[0].x&&t[n].y===d[0].y)return!0}}return!1}function X(e){c&&(e=[]),firebase.database().ref("snake/players/"+f+"/pos").set(e)}function J(){firebase.database().ref("snake/foods").set(x)}alert("We use cookies. By using this site, you agree with it.\n\nWe use the Realtime Database of Google Firebase, to serve multiplayer. If you want to know how Google proceeds your data, look on their page: https://firebase.google.com/support/privacy/\n\nIf you don't want to agree, close this site. No data has been saved yet."),firebase.initializeApp(R),firebase.database().ref("snake/variables/version").on("value",e=>{l=parseInt(data=e.val(),10),function e(){do if(l>14){for(var t in o=!0,d=[],X([]),g)if(otherSnake=d[t],t==f&&!(null==otherSnake||0==Q(otherSnake)))return;o=!1,alert("Client outdated. Please close the tab, delete all cookies and data from this page and reopen this page.\nThe easiest way is to delete all your browsing data.")}else if(l<14){for(var t in o=!0,d=[],X([]),g)if(otherSnake=d[t],t==f&&!(null==otherSnake||0==Q(otherSnake)))return;o=!1,alert("Database outdated. Please wait for the database to update, then reopen this tab.")}else o=!0;while(!o)}()}),function r(){if(!o){setTimeout(r,50);return}document.addEventListener("keydown",D),window.addEventListener("resize",C,!1),I.addEventListener("touchstart",M),window.addEventListener("keydown",function(e){[32,37,38,39,40].indexOf(e.keyCode)>-1&&e.preventDefault()},!1),C(),firebase.database().ref("snake/foods").on("value",e=>{x=null==(data=e.val())?[]:data}),firebase.database().ref("snake/variables/forcedFoodLevel").on("value",e=>{E=null==(data=e.val())?-1:data}),firebase.database().ref("snake/variables/foodFactor").on("value",e=>{B=null==(data=e.val())?1:data}),firebase.database().ref("snake/players").on("value",e=>{if(null==(data=e.val())){k=!0;return}var t=[];for(var r in data){if(r==f){n=data[r].color;continue}t[r]=data[r]}b=t,g=data,k=!0}),function r(){if(!k){setTimeout(r,50);return}(function e(){for(;j()>=t;)alert("The game is full (15/15). Click the button, to retry.")})(),function e(){for(_=!1,f="";""==f;){var t=prompt('Choose a player name:\n\n".", "/", "#", "$", "[", or "]" will be replaced by "_".');if((f=(f=null==t?"":t).replaceAll(".","_").replaceAll("#","_").replaceAll("$","_").replaceAll("[","_").replaceAll("]","_").replaceAll("/","_")).length>16){alert("This name is too long."),f="";continue}firebase.database().ref("snake/players/"+f+"/color").get().then(t=>{if(t.exists()){alert("Someone has already chosen this name."),f="",e();return}_=!0})}}(),function t(){var r;if(!_){setTimeout(t,50);return}firebase.database().ref("snake/players/"+f+"/verifyName").set(f),firebase.database().ref("snake/players/"+f).onDisconnect().remove(),n=(r=function t(){var n=[],r=[],a=0;for(var o in b)null!=(otherSnake=b[o])&&null!=otherSnake.color&&(n[a]=otherSnake.color,a++);for(var l in a=0,e)!Array.from(n).includes(e[l])&&(r[a]=e[l],a++);return r}())[q(0,r.length-1)],firebase.database().ref("snake/players/"+f+"/color").set(n),1>=j()&&0==x.length&&H(Y(),K(),P()),$=Date.now(),function e(){var t=Date.now()-$;if(t>=100){for(var n=Math.max(1,Math.round((t-100)/100)),r=0;r<n;r++)v=!1,A();0!=d.length&&X(d),$=Date.now()}setTimeout(e,1)}(),T()}()}()}()}();
