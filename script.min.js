!function(){let a=["Aqua","Yellow","Red","Black","White","DeepPink","LawnGreen","Orange","SaddleBrown","OrangeRed","DarkViolet","Gold","Indigo","Silver","DarkGreen"],d=a.length;var e,f,g,h=!1,i=0,j=0,k=!1,l=6,m=!0,n="",o=!1,p=[],q=0,r=!1,s=10,t=0,u=[],v=[],w=!1,x=[],y=0,z=0,A=-1;let b=document.getElementById("snakeboard"),B=b.getContext("2d");function C(){j=Date.now(),l=6,m=!0,p=G(),k=!1,D()}function D(){if(--l>0&&l<=3){document.getElementById("status").innerHTML=l,setTimeout(D,500);return}if(l>0){document.getElementById("status").innerHTML="Get ready!",setTimeout(D,500);return}if(ak()){l=-1,document.getElementById("status").innerHTML="Waiting for other snake to go away...",setTimeout(D,50);return}s=10,t=0,l=0,m=!1,Z("Go!",3e3)}function E(){var a=Date.now()-j;if(a>=100){for(var c=Math.max(1,Math.round((a-100)/100)),b=0;b<c;b++)r=!1,F();0!=p.length&&al(p),j=Date.now()}setTimeout(E,1)}function F(){Y(),U(),X(),aj(),0==l&&(k||p.length<=0||J()?k||O():H()),V(),retryClicked&&(retryClicked=!1,S())}function G(){for(var c=ae(4),d=af(),b=[],a=0;a<5;a++){var e=10*a;b[a]={x:c-e,y:d}}return b}function H(){let c={x:p[0].x+s,y:p[0].y+t};p.unshift(c);let d=K();if(d){var a=ab(M())-1;if(a<0)for(var b=0;b>a&&1!=ag(p);b--)p.pop();else y+=a;++a>0?Z("+"+a+"0",1e3,"LimeGreen"):0==a?Z("0",1e3):a<0&&Z(a+"0",1e3,"Red")}else y<=0?p.pop():y--}function I(a,b,c,d){a?(s=0,t=-10):b?(s=-10,t=0):c?(s=0,t=10):d&&(s=10,t=0)}function J(){for(var a=4;a<p.length;a++)if(p[a].x===p[0].x&&p[a].y===p[0].y)return!0;if(ak())return!0;let b=p[0].x<0,c=p[0].x>1270,d=p[0].y<0,e=p[0].y>710;return b||c||d||e}function K(){var a=!1;for(var c in x){var b=x[c];if(p[0].x===b.x&&p[0].y===b.y){a=!0;break}}return a}function L(a,b,c){x[x.length]={x:a,y:b,level:c},am()}function M(){var f=function(d,e){var b=[],c=3;for(var f in i=0,x){var a=x[f];foodX=a.x,foodY=a.y,d!=foodX||e!=foodY?(b[i]=a,i++):c=a.level}return x=b,am(),c}(p[0].x,p[0].y),c=Math.max(1,Math.round(ai()/2));c-=x.length;for(var d=0;d<c;d++){for(var a,b=!0;b;)for(var g in a=N(),0==x.length&&(b=!1),x){var e=x[g];(e.x!=a.x||e.y!=a.y)&&(b=!1)}L(a.x,a.y,aa())}return f}function N(){var a=ae(),b=af();return p.forEach(c=>{let d=c.x==a&&c.y==b;d&&N()}),u.forEach(c=>{let d=c.x==a&&c.y==b;d&&N()}),{x:a,y:b}}function O(){k=!0,al([]),function(){if(!(5>=ag(p)))for(var b in p){var a=p[b];a.x<0||a.x>1270||a.y<0||a.y>710||0==ad(0,5)&&L(a.x,a.y,aa())}}(),p=[],document.getElementById("status").style.visibility="visible",document.getElementById("status").innerHTML='<b><span style="color: Red; display: inline;"> Game Over!</span></b>',document.getElementById("score").style.visibility="visible",document.getElementById("score").innerHTML="Your score: "+q+'<button id="buttonRetry" class="button retry" onclick="onRetryClick()">Retry (r)</button>'}function P(){T()}function Q(b){if(r)return;r=!0;let a=b.keyCode,c=-10===t,d=10===t,e=10===s,f=-10===s;I((38===a||87===a)&&!d,(37===a||65===a)&&!e,(40===a||83===a)&&!c,(39===a||68===a)&&!f),(13===a||82===a)&&S()}function R(c){var d=b.getBoundingClientRect();let a=(c.touches[0].clientX-d.left)/(f/1280),e=(c.touches[0].clientY-d.top)/(g/720);if(r)return;r=!0;let h=-10===t,i=10===t,j=10===s,k=-10===s,l=360>e&&!(320>a)&&!(960<a)&&!i,m=320>a&&!j,n=360<e&&!(320>a)&&!(960<a)&&!h,o=960<a&&!k;I(l,m,n,o)}function S(){k&&(document.getElementById("score").style.visibility="hidden",C())}function T(){var a=7*window.innerWidth/8,c=3*window.innerHeight/4,d=1280/a,e=720/c;d>e?(f=a,g=a/1.7777777777777777):e>d?(f=1.7777777777777777*c,g=c):(f=a,g=c),b.width=f,b.height=g,B.scale(f/1280,g/720)}function U(){B.fillStyle="LightGrey",B.fillRect(0,0,1280,720)}function V(){0!=p.length&&p.forEach(a=>W(e,a))}function W(b,a){B.fillStyle=b,B.strokestyle="black",B.fillRect(a.x,a.y,10,10),B.strokeRect(a.x,a.y,10,10)}function X(){for(var b in x){var a=x[b];B.fillStyle=$(_(a.level)),B.strokestyle="black",B.fillRect(a.x,a.y,10,10),B.strokeRect(a.x,a.y,10,10)}z++}function Y(){var c=[],d="";for(var a in i=0,v){var b=ag(v[a].pos)-5;q=b>=0&&a==n?b:q,c[i]={score:b,playerName:a},i++}for(var f in c.sort((a,b)=>b.score-a.score),c){var e=c[f],b=e.score,a=e.playerName;d+='<span style="color:'+v[a].color+';text-shadow: 1px 0 black, -1px 0 black, 0 1px black, 0 -1px black, 1px 1px black, -1px -1px black, -1px 1px black, 1px -1px black;">'+ac(a)+"</span>: "+(b< -4?"Spectator":b)+"<br>"}document.getElementById("sidebar").innerHTML="Online: "+ah()+"/15<br><br>"+d}function Z(b,c,a){a=a||"Black",document.getElementById("status").style.visibility="visible",document.getElementById("status").innerHTML='<div style="color:'+a+';">'+b+"</div>",setTimeout(()=>{document.getElementById("status").innerHTML==='<div style="color:'+a+';">'+b+"</div>"&&(document.getElementById("status").style.visibility="hidden")},c)}function $(a){return 50==z&&(z=-50),Color({h:a,s:100,v:(z<0?-1*z:z)+50}).toString()}function _(a){switch(a){case 0:return 175;case 1:return 110;case 2:default:return 0;case 3:return 10*ad(0,30)}}function aa(){if(A>=0)return A;var a=ad(0,300);return a>=0&&a<100?0:a>=100&&a<200?1:a>=200&&a<250?2:3}function ab(a){switch(a){case 0:case 1:case 2:return a+1;case 3:return ad(-5,5);default:return 0}}function ac(a){return String(a).replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace('"',"&quot;")}function ad(a,b){return Math.round(Math.random()*(b-a)+a)}function ae(a){return 10*Math.round(ad(10*(a=a||0),1270)/10)}function af(){return 10*Math.round(ad(0,710)/10)}function ag(b){var a=0;for(var c in b)a++;return a}function ah(){return ag(v)}function ai(){var a=0;for(var c in v){var b=v[c];null!=b.pos&&0!=ag(b.pos)&&a++}return a}function aj(){for(var b in u){var a=u[b];null!=a&&null!=a.pos&&a.pos.forEach(b=>W(null==a.color?"red":a.color,b))}}function ak(){for(var c in u){var a=u[c].pos;if(null!=a){for(var b=0;b<a.length;b++)if(a[b].x===p[0].x&&a[b].y===p[0].y)return!0}}return!1}function al(a){m&&(a=[]),firebase.database().ref("snake/players/"+n+"/pos").set(a)}function am(){firebase.database().ref("snake/foods").set(x)}function c(){if(!h){setTimeout(c,50);return}document.addEventListener("keydown",Q),window.addEventListener("resize",P,!1),b.addEventListener("touchstart",R),window.addEventListener("keydown",function(a){[32,37,38,39,40].indexOf(a.keyCode)> -1&&a.preventDefault()},!1),P(),firebase.database().ref("snake/foods").on("value",a=>{x=null==(data=a.val())?[]:data}),firebase.database().ref("snake/forcedFoodLevel").on("value",a=>{A=null==(data=a.val())?-1:data}),firebase.database().ref("snake/players").on("value",c=>{if(null==(data=c.val())){w=!0;return}var b=[];for(var a in data){if(a==n){e=data[a].color;continue}b[a]=data[a]}u=b,v=data,w=!0}),an()}function an(){if(!w){setTimeout(an,50);return}!function(){for(;ah()>=d;)alert("The game is full (15/15). Click the button, to retry.")}(),ap(),ao()}function ao(){var b;if(!o){setTimeout(ao,50);return}firebase.database().ref("snake/players/"+n+"/verifyName").set(n),firebase.database().ref("snake/players/"+n).onDisconnect().remove(),e=(b=function(){var c=[],d=[],b=0;for(var f in u)null!=(otherSnake=u[f])&&null!=otherSnake.color&&(c[b]=otherSnake.color,b++);for(var e in b=0,a)!Array.from(c).includes(a[e])&&(d[b]=a[e],b++);return d}())[ad(0,b.length-1)],firebase.database().ref("snake/players/"+n+"/color").set(e),1>=ah()&&0==x.length&&L(ae(),af(),aa()),j=Date.now(),E(),C()}function ap(){for(o=!1,n="";""==n;){var a=prompt('Choose a player name:\n\n".", "/", "#", "$", "[", or "]" will be replaced by "_".');if((n=(n=null==a?"":a).replaceAll(".","_").replaceAll("#","_").replaceAll("$","_").replaceAll("[","_").replaceAll("]","_").replaceAll("/","_")).length>16){alert("This name is too long."),n="";continue}firebase.database().ref("snake/players/"+n+"/color").get().then(a=>{if(a.exists()){alert("Someone has already chosen this name."),n="",ap();return}o=!0})}}alert("We use cookies. By using this site, you agree with it.\n\nWe use the Realtime Database of Google Firebase, to serve multiplayer. If you want to know how Google proceeds your data, look on their page: https://firebase.google.com/support/privacy/\n\nIf you don't want to agree, close this site. No data has been saved yet."),firebase.initializeApp({apiKey:"AIzaSyBbRpK_BcltEmRQzLAUCFykMHEq5PQWWz4",authDomain:"psyched-canto-311609.firebaseapp.com",databaseURL:"https://psyched-canto-311609-default-rtdb.europe-west1.firebasedatabase.app",projectId:"psyched-canto-311609",storageBucket:"psyched-canto-311609.appspot.com",messagingSenderId:"556381649934",appId:"1:556381649934:web:af27169882d8297d78d05f"}),firebase.database().ref("snake/version").on("value",a=>{i=parseInt(data=a.val(),10),function(){do if(i>10){for(var a in h=!0,p=[],al([]),v)if(otherSnake=p[a],a==n&&!(null==otherSnake||0==ag(otherSnake)))return;h=!1,alert("Client outdated. Please close the tab, delete all cookies and data from this page and reopen this page.\nThe easiest way is to delete all your browsing data.")}else if(i<10){for(var a in h=!0,p=[],al([]),v)if(otherSnake=p[a],a==n&&!(null==otherSnake||0==ag(otherSnake)))return;h=!1,alert("Database outdated. Please wait for the database to update, then reopen this tab.")}else h=!0;while(!h)}()}),c()}()