!function(){const e=3,t="LightGrey",n=["Aqua","Yellow","Red","Black","White","DeepPink","LawnGreen","Orange","SaddleBrown","OrangeRed","DarkViolet","Gold","Indigo","Silver","DarkGreen"],a=100,r=0,o=1,l=2,s=3,u=175,c=110,f=0,d=n.length;var y,v=!1,p=0,h=0,b=!1,g=6,m=!0,k="",x=!1,w=[],E=!1,S=10,B=0,I=[],T=[],R=!1,L=[],M=0,A=-1;const C=document.getElementById("snakeboard"),D=C.getContext("2d"),G=1280,H=720;var _,W,z={apiKey:"AIzaSyBbRpK_BcltEmRQzLAUCFykMHEq5PQWWz4",authDomain:"psyched-canto-311609.firebaseapp.com",databaseURL:"https://psyched-canto-311609-default-rtdb.europe-west1.firebasedatabase.app",projectId:"psyched-canto-311609",storageBucket:"psyched-canto-311609.appspot.com",messagingSenderId:"556381649934",appId:"1:556381649934:web:af27169882d8297d78d05f"};function N(){h=Date.now(),g=6,m=!0,w=function(){for(var e=re(4),t=oe(),n=[],a=0;a<5;a++){var r=10*a;n[a]={x:e-r,y:t}}return n}(),b=!1,O()}function O(){return--g>0&&g<=3?(document.getElementById("status").innerHTML=g,void setTimeout(O,500)):g>0?(document.getElementById("status").innerHTML="Get ready!",void setTimeout(O,500)):se()?(g=-1,document.getElementById("status").innerHTML="Waiting for other snake to go away...",void setTimeout(O,50)):(S=10,B=0,g=0,m=!1,void J("Go!",3e3))}function P(){var e=Date.now()-h;if(e>=a){for(var t=e-a,n=Math.max(1,Math.round(t/a)),r=0;r<n;r++)E=!1,Y();0!=w.length&&ue(w),h=Date.now()}setTimeout(P,1)}function Y(){!function(){var e=[],t="";for(var n in i=0,T){var a=10*(ie(T[n].pos)-5);e[i]={score:a,playerName:n},i++}for(var r in e.sort((e,t)=>t.score-e.score),e){var o=e[r],a=o.score,n=o.playerName,l=T[n];t+='<span style="color:'+l.color+';text-shadow: 1px 0 black, -1px 0 black, 0 1px black, 0 -1px black, 1px 1px black, -1px -1px black, -1px 1px black, 1px -1px black;">'+String(n).replace("&","&amp;").replace("<","&lt;").replace(">","&gt;").replace('"',"&quot;")+"</span>: "+a+"<br>"}document.getElementById("sidebar").innerHTML="Online: "+le()+"/15<br><br>"+t}(),D.fillStyle=t,D.fillRect(0,0,G,H),function(){for(var e in L){var t=L[e];D.fillStyle=ee(te(t.level)),D.strokestyle="black",D.fillRect(t.x,t.y,10,10),D.strokeRect(t.x,t.y,10,10)}M++}(),function(){for(var e in I){var t=I[e];null!=t&&null!=t.pos&&t.pos.forEach(e=>V(null==t.color?"red":t.color,e))}}(),0!=g||(b||w.length<=0||function(){for(var e=4;e<w.length;e++)if(w[e].x===w[0].x&&w[e].y===w[0].y)return!0;if(se())return!0;const t=w[0].x<0,n=w[0].x>G-10,a=w[0].y<0,r=w[0].y>H-10;return t||n||a||r}()?b||(b=!0,ue([]),w=[],document.getElementById("status").style.visibility="visible",document.getElementById("status").innerHTML='<b><div style="color: Red; display: inline;">Game Over!</div></b> <button id="buttonRetry" class="button retry" onclick="onRetryClick()">Retry (r)</button>'):function(){const e={x:w[0].x+S,y:w[0].y+B};if(w.unshift(e),function(){var e=!1;for(var t in L){var n=L[t];if(w[0].x===n.x&&w[0].y===n.y){e=!0;break}}return e}()){var t=function(e){switch(e){case r:case o:case l:return e+1;case s:return ae(-5,5);default:return 0}}(function(){var e=X(w[0].x,w[0].y),t=Math.max(1,Math.round(function(){var e=0;for(var t in T){var n=T[t];null!=n.pos&&0!=ie(n.pos)&&e++}return e}()/2));t-=L.length;for(var n=0;n<t;n++){for(var a,r=!0;r;)for(var o in a=K(),0==L.length&&(r=!1),L){var i=L[o];i.x==a.x&&i.y==a.y||(r=!1)}F(a.x,a.y,ne())}return e}())-1;if(t<0)for(var n=0;n>t&&1!=ie(w);n--)w.pop();else for(var n=0;n<t;n++){var a=w[w.length-1].x-S,i=w[w.length-1].y-B;w[ie(w)]={x:a,y:i}}++t>0?J("+"+t+"0",1e3,"LimeGreen"):0==t?J("0",1e3):t<0&&J(t+"0",1e3,"Red")}else w.pop()}()),function(){if(0==w.length)return;w.forEach(e=>V(y,e))}(),retryClicked&&(retryClicked=!1,j())}function q(e,t,n,a){e?(S=0,B=-10):t?(S=-10,B=0):n?(S=0,B=10):a&&(S=10,B=0)}function F(e,t,n){L[L.length]={x:e,y:t,level:n},ce()}function X(e,t){var n=[],a=s;for(var r in i=0,L){var o=L[r];foodX=o.x,foodY=o.y,e!=foodX||t!=foodY?(n[i]=o,i++):a=o.level}return L=n,ce(),a}function K(){var e=re(),t=oe();return w.forEach(n=>{n.x==e&&n.y==t&&K()}),I.forEach(n=>{n.x==e&&n.y==t&&K()}),{x:e,y:t}}function Q(){!function(){var e=7*window.innerWidth/8,t=3*window.innerHeight/4,n=G/H,a=G/e,r=H/t;a>r?(_=e,W=e/n):r>a?(_=t*n,W=t):(_=e,W=t);C.width=_,C.height=W,D.scale(_/G,W/H)}()}function U(e){if(E)return;E=!0;const t=e.keyCode;q((38===t||87===t)&&!(10===B),(37===t||65===t)&&!(10===S),(40===t||83===t)&&!(-10===B),(39===t||68===t)&&!(-10===S)),13!==t&&82!==t||j()}function $(e){var t=e.target.getBoundingClientRect(),n=_/G,a=W/H;const r=(e.clientX-t.left)/n,o=(e.clientY-t.top)/a;E||(E=!0,q(!(!(H/2>o)||G/4>r||G-G/4<r||10===B),G/4>r&&!(10===S),!(!(H/2<o)||G/4>r||G-G/4<r||-10===B),G-G/4<r&&!(-10===S)))}function j(){b&&N()}function V(e,t){D.fillStyle=e,D.strokestyle="black",D.fillRect(t.x,t.y,10,10),D.strokeRect(t.x,t.y,10,10)}function J(e,t,n){n=n||"Black",document.getElementById("status").style.visibility="visible",document.getElementById("status").innerHTML='<div style="color:'+n+';">'+e+"</div>",setTimeout(()=>{document.getElementById("status").innerHTML==='<div style="color:'+n+';">'+e+"</div>"&&(document.getElementById("status").style.visibility="hidden")},t)}function Z(){var e=function(){var e=[],t=[],a=0;for(var r in I)otherSnake=I[r],null!=otherSnake&&null!=otherSnake.color&&(e[a]=otherSnake.color,a++);for(var o in a=0,n)Array.from(e).includes(n[o])||(t[a]=n[o],a++);return t}();return e[ae(0,e.length-1)]}function ee(e){return 50==M&&(M=-50),Color({h:e,s:100,v:(M<0?-1*M:M)+50}).toString()}function te(e){switch(e){case r:return u;case o:return c;case l:return f;case s:return 10*ae(0,30);default:return 0}}function ne(){if(A>=0)return A;var e=ae(0,300);return e>=0&&e<100?r:e>=100&&e<200?o:e>=200&&e<250?l:s}function ae(e,t){return Math.round(Math.random()*(t-e)+e)}function re(e){return e=e||0,10*Math.round(ae(10*e,G-10)/10)}function oe(){return 10*Math.round(ae(0,H-10)/10)}function ie(e){var t=0;for(var n in e)t++;return t}function le(){return ie(T)}function se(){for(var e in I){var t=I[e].pos;if(null!=t)for(var n=0;n<t.length;n++)if(t[n].x===w[0].x&&t[n].y===w[0].y)return!0}return!1}function ue(e){m&&(e=[]),firebase.database().ref("snake/players/"+k+"/pos").set(e)}function ce(){firebase.database().ref("snake/foods").set(L)}function fe(){v?(document.addEventListener("keydown",U),window.addEventListener("resize",Q,!1),C.addEventListener("click",$),Q(),firebase.database().ref("snake/foods").on("value",e=>{data=e.val(),L=null==data?[]:data}),firebase.database().ref("snake/forcedFoodLevel").on("value",e=>{data=e.val(),A=null==data?-1:data}),firebase.database().ref("snake/players").on("value",e=>{if(data=e.val(),null!=data){var t=[];for(var n in data)n!=k?t[n]=data[n]:y=data[n].color;I=t,T=data,R=!0}else R=!0}),de()):setTimeout(fe,50)}function de(){R?(!function(){for(;le()>=d;)alert("The game is full (15/15). Click the button, to retry.")}(),function e(){x=!1;k="";for(;""==k;){var t=prompt('Choose a player name:\n\n".", "/", "#", "$", "[", or "]" will be replaced by "_".');(k=(k=null==t?"":t).replaceAll(".","_").replaceAll("#","_").replaceAll("$","_").replaceAll("[","_").replaceAll("]","_").replaceAll("/","_")).length>16?(alert("This name is too long."),k=""):firebase.database().ref("snake/players/"+k+"/color").get().then(t=>{if(t.exists())return alert("Someone has already chosen this name."),k="",void e();x=!0})}}(),ye()):setTimeout(de,50)}function ye(){x?(firebase.database().ref("snake/players/"+k+"/verifyName").set(k),firebase.database().ref("snake/players/"+k).onDisconnect().remove(),y=Z(),firebase.database().ref("snake/players/"+k+"/color").set(y),le()<=1&&0==L.length&&F(re(),oe(),ne()),h=Date.now(),P(),N()):setTimeout(ye,50)}alert("We use cookies. By using this site, you agree with it.\n\nWe use the Realtime Database of Google Firebase, to serve multiplayer. If you want to know how Google proceeds your data, look on their page: https://firebase.google.com/support/privacy/\n\nIf you don't want to agree, close this site. No data has been saved yet."),firebase.initializeApp(z),firebase.database().ref("snake/version").on("value",t=>{data=t.val(),p=parseInt(data,10),function(){do{if(p>e){for(var t in v=!0,w=[],ue([]),T)if(otherSnake=w[t],t==k&&null!=otherSnake&&0!=ie(otherSnake))return;v=!1,alert("Client outdated. Please close the tab, delete all cookies and data from this page and reopen this page.\nThe easiest way is to delete all your browsing data.")}else if(p<e){for(var t in v=!0,w=[],ue([]),T)if(otherSnake=w[t],t==k&&null!=otherSnake&&0!=ie(otherSnake))return;v=!1,alert("Database outdated. Please wait for the database to update, then reopen this tab.")}else v=!0}while(!v)}()}),fe()}();